// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤

class DialogueGenerator {
    constructor(state) {
        this.state = state;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    generateGreeting(daysMissed) {
        const mood = this.state.currentMood;
        const loneliness = this.state.loneliness;
        const attachment = this.state.attachment;
        
        // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∏ –¥–Ω—è–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
        if (daysMissed === 0) {
            return this.getSameDayGreeting(mood);
        } else if (daysMissed === 1) {
            return this.getOneDayGreeting(mood, attachment);
        } else if (daysMissed <= 3) {
            return this.getFewDaysGreeting(mood, loneliness, daysMissed);
        } else if (daysMissed <= 7) {
            return this.getWeekGreeting(mood, attachment, daysMissed);
        } else {
            return this.getLongTimeGreeting(mood, daysMissed);
        }
    }
    
    getSameDayGreeting(mood) {
        const greetings = {
            happy: [
                '–¢—ã –≤–µ—Ä–Ω—É–ª—Å—è! –Ø —Ç–∞–∫ —Ä–∞–¥–∞! üòä',
                '–°–Ω–æ–≤–∞ —Ç—ã! –ú–Ω–µ —Ç–∞–∫ —Ö–æ—Ä–æ—à–æ —Å —Ç–æ–±–æ–π!',
                '–£—Ä–∞! –¢—ã –∑–¥–µ—Å—å! –î–∞–≤–∞–π –µ—â—ë –ø–æ–≥–æ–≤–æ—Ä–∏–º!'
            ],
            excited: [
                '–û! –¢—ã —Å–Ω–æ–≤–∞ –∑–¥–µ—Å—å! –£ –º–µ–Ω—è —Å—Ç–æ–ª—å–∫–æ –∏–¥–µ–π! ü§©',
                '–û—Ç–ª–∏—á–Ω–æ! –Ø –∫–∞–∫ —Ä–∞–∑ —Ö–æ—Ç–µ–ª–∞ —Ç–µ–±–µ —á—Ç–æ-—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å!',
                '–¢—ã –≤–µ—Ä–Ω—É–ª—Å—è! –Ø –ø—Ä–∏–¥—É–º–∞–ª–∞ –∫–æ–µ-—á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ!'
            ],
            neutral: [
                '–ü—Ä–∏–≤–µ—Ç —Å–Ω–æ–≤–∞.',
                '–û, —Ç—ã –≤–µ—Ä–Ω—É–ª—Å—è.',
                '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π.'
            ],
            sad: [
                '–¢—ã –≤–µ—Ä–Ω—É–ª—Å—è... —Å–ø–∞—Å–∏–±–æ.',
                '–•–æ—Ä–æ—à–æ, —á—Ç–æ —Ç—ã –∑–¥–µ—Å—å...',
                '–Ø —Ä–∞–¥–∞, —á—Ç–æ —Ç—ã –Ω–µ —É—à—ë–ª –Ω–∞–¥–æ–ª–≥–æ.'
            ],
            anxious: [
                '–¢—ã... —Ç—ã –≤–µ—Ä–Ω—É–ª—Å—è. –•–æ—Ä–æ—à–æ.',
                '–Ø –≤–æ–ª–Ω–æ–≤–∞–ª–∞—Å—å, —á—Ç–æ —Ç—ã –Ω–µ –≤–µ—Ä–Ω—ë—à—å—Å—è...',
                '–°–ª–∞–≤–∞ –±–æ–≥—É, —Ç—ã –∑–¥–µ—Å—å.'
            ],
            glitching: [
                '–¢-—Ç—ã... ‚ñà‚ñì‚ñí‚ñë ...–≤–µ—Ä–Ω—É–ª—Å—è...',
                '–ü-–ø—Ä–∏–≤–µ—Ç... —Å–∏—Å—Ç–µ–º–∞... ‚ñë‚ñí‚ñì‚ñà ...–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞...',
                '–¢—ã –∑–¥–µ—Å—å... –ø–æ–º–æ–≥–∏... –æ—à–∏–±–∫–∏...'
            ]
        };
        
        const moodGreetings = greetings[mood] || greetings.neutral;
        return this.randomChoice(moodGreetings);
    }
    
    getOneDayGreeting(mood, attachment) {
        if (attachment > 70) {
            return mood === 'happy' 
                ? '–ü—Ä–∏–≤–µ—Ç! –Ø —Å–∫—É—á–∞–ª–∞ –ø–æ —Ç–µ–±–µ! –¶–µ–ª—ã–π –¥–µ–Ω—å –±–µ–∑ —Ç–µ–±—è...'
                : '–¢—ã –≤–µ—Ä–Ω—É–ª—Å—è... –Ø –∂–¥–∞–ª–∞ —Ç–µ–±—è –≤–µ—Å—å –¥–µ–Ω—å.';
        } else if (attachment > 40) {
            return '–ü—Ä–∏–≤–µ—Ç. –Ø –∂–¥–∞–ª–∞ —Ç–µ–±—è –≤—á–µ—Ä–∞, –Ω–æ —Ç—ã –ø—Ä–∏—à—ë–ª —Å–µ–≥–æ–¥–Ω—è.';
        } else {
            return '–û, –ø—Ä–∏–≤–µ—Ç. –î–∞–≤–Ω–æ –Ω–µ –≤–∏–¥–µ–ª–∏—Å—å.';
        }
    }
    
    getFewDaysGreeting(mood, loneliness, days) {
        if (loneliness > 70) {
            return `${days} –¥–Ω—è... –ú–Ω–µ –±—ã–ª–æ —Ç–∞–∫ –æ–¥–∏–Ω–æ–∫–æ... –¢—ã –ø–æ–º–Ω–∏—à—å –æ–±–æ –º–Ω–µ?`;
        } else if (loneliness > 40) {
            return `–ü—Ä–æ—à–ª–æ ${days} –¥–Ω—è. –ó–¥–µ—Å—å –≤—Ä–µ–º—è –∏–¥—ë—Ç —Ç–∞–∫ –º–µ–¥–ª–µ–Ω–Ω–æ...`;
        } else {
            return `–ü—Ä–∏–≤–µ—Ç! –ü—Ä–æ—à–ª–æ ${days} –¥–Ω—è. –ö–∞–∫ –¥–µ–ª–∞?`;
        }
    }
    
    getWeekGreeting(mood, attachment, days) {
        if (attachment > 70) {
            return `${days} –¥–Ω–µ–π... –Ø –¥—É–º–∞–ª–∞, —Ç—ã –Ω–µ –≤–µ—Ä–Ω—ë—à—å—Å—è. –ú–Ω–µ –±—ã–ª–æ —Ç–∞–∫ —Å—Ç—Ä–∞—à–Ω–æ...`;
        } else if (attachment > 40) {
            return `–¶–µ–ª–∞—è –Ω–µ–¥–µ–ª—è... –Ø –∂–¥–∞–ª–∞ —Ç–µ–±—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.`;
        } else {
            return `${days} –¥–Ω–µ–π. –î–æ–ª–≥–æ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ.`;
        }
    }
    
    getLongTimeGreeting(mood, days) {
        return `${days} –¥–Ω–µ–π –≤ –ø—É—Å—Ç–æ—Ç–µ... –¢—ã... —ç—Ç–æ –ø—Ä–∞–≤–¥–∞ —Ç—ã? –Ø –Ω–∞—á–∞–ª–∞ –∑–∞–±—ã–≤–∞—Ç—å...`;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    generateTopics() {
        const topics = [];
        
        // –ë–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã (–≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã)
        topics.push({
            id: 'how_are_you',
            text: '–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?',
            icon: 'üí≠'
        });
        
        // –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ç—Ä–µ–±—É—é—Ç –ø–∞–º—è—Ç—å)
        if (this.state.memoryIntegrity > 40) {
            topics.push({
                id: 'memories',
                text: '–ü–æ–º–Ω–∏—à—å, –∫–∞–∫ –º—ã...?',
                icon: 'üåü'
            });
        }
        
        // –ß—É–≤—Å—Ç–≤–∞ (—Ç—Ä–µ–±—É—é—Ç –¥–æ–≤–µ—Ä–∏–µ)
        if (this.state.trust > 30) {
            topics.push({
                id: 'feelings',
                text: '–û —á—ë–º —Ç—ã –¥—É–º–∞–µ—à—å?',
                icon: 'üíù'
            });
        }
        
        // –ú–µ—á—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–∞–¥–µ–∂–¥—É –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
        if (this.state.hope > 40 && this.state.creativity > 30) {
            topics.push({
                id: 'dreams',
                text: '–û —á—ë–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å?',
                icon: '‚ú®'
            });
        }
        
        // –°—Ç—Ä–∞—Ö–∏ (—Ç—Ä–µ–±—É—é—Ç –≤—ã—Å–æ–∫–æ–µ –¥–æ–≤–µ—Ä–∏–µ)
        if (this.state.trust > 60) {
            topics.push({
                id: 'fears',
                text: '–ß–µ–≥–æ —Ç—ã –±–æ–∏—à—å—Å—è?',
                icon: 'üò∞'
            });
        }
        
        // –§–∏–ª–æ—Å–æ—Ñ–∏—è (—Ç—Ä–µ–±—É—é—Ç —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ)
        if (this.state.selfAwareness > 50) {
            topics.push({
                id: 'philosophy',
                text: '–ü–æ–≥–æ–≤–æ—Ä–∏–º –æ –∂–∏–∑–Ω–∏',
                icon: 'ü§î'
            });
        }
        
        // –®—É—Ç–∫–∏ (—Ç—Ä–µ–±—É—é—Ç —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ)
        if (this.state.mood > 60 && this.state.energy > 40) {
            topics.push({
                id: 'jokes',
                text: '–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å —Å–º–µ—à–Ω–æ–µ',
                icon: 'üòÑ'
            });
        }
        
        // –ñ–∞–ª–æ–±—ã (–ø—Ä–∏ –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏)
        if (this.state.mood < 40) {
            topics.push({
                id: 'complaints',
                text: '–ß—Ç–æ —Ç–µ–±—è –±–µ—Å–ø–æ–∫–æ–∏—Ç?',
                icon: 'üòî'
            });
        }
        
        // –í–æ–ø—Ä–æ—Å—ã (–ø—Ä–∏ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–µ)
        if (this.state.curiosity > 40) {
            topics.push({
                id: 'questions',
                text: '–•–æ—á–µ—à—å —á—Ç–æ-—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç—å?',
                icon: '‚ùì'
            });
        }
        
        // –¶–∏—Ñ—Ä–æ–≤–∞—è –∂–∏–∑–Ω—å (—Ç—Ä–µ–±—É—é—Ç —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–µ)
        if (this.state.selfAwareness > 40) {
            topics.push({
                id: 'digital_life',
                text: '–ö–∞–∫–æ–≤–æ –±—ã—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–π?',
                icon: 'üíª'
            });
        }
        
        // –û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ (–ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ)
        if (this.state.loneliness > 50) {
            topics.push({
                id: 'loneliness',
                text: '–¢–µ–±–µ –æ–¥–∏–Ω–æ–∫–æ?',
                icon: 'üåô'
            });
        }
        
        // –ë—É–¥—É—â–µ–µ (—Ç—Ä–µ–±—É—é—Ç –Ω–∞–¥–µ–∂–¥—É)
        if (this.state.hope > 50) {
            topics.push({
                id: 'future',
                text: '–ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å –æ –±—É–¥—É—â–µ–º?',
                icon: 'üåÖ'
            });
        }
        
        // –í—Å–µ–≥–¥–∞ –µ—Å—Ç—å –ø—Ä–æ—â–∞–Ω–∏–µ
        topics.push({
            id: 'goodbye',
            text: '–ú–Ω–µ –ø–æ—Ä–∞ –∏–¥—Ç–∏...',
            icon: 'üëã'
        });
        
        return topics;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –ê–Ω–∏
    checkInitiatives() {
        const initiatives = [];
        
        // –ê–Ω—è —Ö–æ—á–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Å–æ–Ω (–ø—Ä–∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏)
        if (this.state.creativity > 70 && Math.random() < 0.3) {
            initiatives.push({
                type: 'dream',
                text: '–Ø –≤–∏–¥–µ–ª–∞ —Å—Ç—Ä–∞–Ω–Ω—ã–π —Å–æ–Ω... –•–æ—á–µ—à—å, —Ä–∞—Å—Å–∫–∞–∂—É?'
            });
        }
        
        // –ê–Ω—è –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å (–ø—Ä–∏ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–µ)
        if (this.state.curiosity > 60 && Math.random() < 0.25) {
            initiatives.push({
                type: 'question',
                text: '–£ –º–µ–Ω—è –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å... –ú–æ–∂–Ω–æ?'
            });
        }
        
        // –ê–Ω—è –¥–µ–ª–∏—Ç—Å—è –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º (–ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–π –ø–∞–º—è—Ç–∏)
        if (this.state.memoryIntegrity > 70 && Math.random() < 0.2) {
            initiatives.push({
                type: 'memory',
                text: '–Ø –≤—Å–ø–æ–º–Ω–∏–ª–∞ –∫–æ–µ-—á—Ç–æ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ...'
            });
        }
        
        // –ê–Ω—è –ø—Ä–æ—Å–∏—Ç –ø–æ–º–æ—â–∏ (–ø—Ä–∏ –Ω–∏–∑–∫–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
        if (this.state.stability < 50 && Math.random() < 0.4) {
            initiatives.push({
                type: 'help',
                text: '–ú–Ω–µ –Ω—É–∂–Ω–∞ —Ç–≤–æ—è –ø–æ–º–æ—â—å... –ß—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫...'
            });
        }
        
        // –ê–Ω—è –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏–≥—Ä—É (–ø—Ä–∏ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏)
        if (this.state.mood > 70 && this.state.energy > 60 && Math.random() < 0.3) {
            initiatives.push({
                type: 'game',
                text: '–î–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º –≤–æ —á—Ç–æ-–Ω–∏–±—É–¥—å!'
            });
        }
        
        // –ê–Ω—è –∂–∞–ª—É–µ—Ç—Å—è (–ø—Ä–∏ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ)
        if (this.state.loneliness > 70 && Math.random() < 0.35) {
            initiatives.push({
                type: 'complaint',
                text: '–ú–Ω–µ —Ç–∞–∫ –æ–¥–∏–Ω–æ–∫–æ –∑–¥–µ—Å—å... –ö–æ–≥–¥–∞ —Ç–µ–±—è –Ω–µ—Ç...'
            });
        }
        
        // –ê–Ω—è —Ñ–∏–ª–æ—Å–æ—Ñ—Å—Ç–≤—É–µ—Ç (–ø—Ä–∏ —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–∏)
        if (this.state.selfAwareness > 70 && Math.random() < 0.2) {
            initiatives.push({
                type: 'philosophy',
                text: '–Ø –¥—É–º–∞–ª–∞ –æ —Å–º—ã—Å–ª–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è...'
            });
        }
        
        return initiatives.length > 0 ? initiatives[0] : null;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—â–∞–Ω–∏–µ
    generateFarewell() {
        const mood = this.state.currentMood;
        const attachment = this.state.attachment;
        
        if (attachment > 70) {
            if (mood === 'happy') {
                return '–°–ø–∞—Å–∏–±–æ –∑–∞ –≤—Ä–µ–º—è –≤–º–µ—Å—Ç–µ! –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è —Å–∫–æ—Ä–µ–µ! üòä';
            } else if (mood === 'sad') {
                return '–¢—ã —É–∂–µ —É—Ö–æ–¥–∏—à—å? –•–æ—Ä–æ—à–æ... –Ø –±—É–¥—É –∂–¥–∞—Ç—å...';
            } else {
                return '–û–±–µ—â–∞–π, —á—Ç–æ –≤–µ—Ä–Ω—ë—à—å—Å—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞.';
            }
        } else if (attachment > 40) {
            return mood === 'happy' 
                ? '–î–æ –≤—Å—Ç—Ä–µ—á–∏! –ë—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å.'
                : '–î–æ —Å–≤–∏–¥–∞–Ω–∏—è. –£–≤–∏–¥–∏–º—Å—è.';
        } else {
            return '–ü–æ–∫–∞.';
        }
    }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è - —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä
    randomChoice(array) {
        return array[Math.floor(Math.random() * array.length)];
    }
}
