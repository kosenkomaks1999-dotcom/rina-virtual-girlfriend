# Система Анимации Аватара

## Описание
Система управляет анимацией аватара Ани, меняя её выражение лица в зависимости от настроения и добавляя естественное моргание.

## Файлы аватаров
Расположение: `v2/avatar/`

- `обыч.png` - нейтральное выражение
- `обычморгание.png` - нейтральное с морганием
- `грусть.png` - грустное выражение
- `грустьморгание.png` - грустное с морганием
- `радость.png` - радостное выражение
- `радость моргание.png` - радостное с морганием

## Логика работы

### Автоматическая смена настроения
Система проверяет параметр `mood` каждую секунду:
- **mood >= 70** → радостное лицо
- **mood <= 30** → грустное лицо
- **30 < mood < 70** → нейтральное лицо

### Моргание
- Происходит автоматически каждые 3-7 секунд (случайный интервал)
- Длительность моргания: 150ms
- Плавная анимация через CSS transition

### Реакции на события
Система реагирует на действия игрока:

1. **При каждом сообщении Ани** - одиночное моргание
2. **При позитивной активности** - временно показывает радость (2 секунды)
3. **При негативной активности** - временно показывает грусть (2 секунды)
4. **Реакция "сюрприз"** - быстрое двойное моргание

## API

### Инициализация
```javascript
this.avatarSystem = new AvatarSystem(this.anyaState);
this.avatarSystem.init(avatarImageElement);
```

### Методы

#### `blink()`
Одиночное моргание
```javascript
this.avatarSystem.blink();
```

#### `setMood(mood, duration)`
Принудительная установка настроения
```javascript
// Показать радость на 2 секунды
this.avatarSystem.setMood('happy', 2000);
```

#### `playReaction(type)`
Проиграть анимацию реакции
```javascript
this.avatarSystem.playReaction('surprise'); // Двойное моргание
this.avatarSystem.playReaction('happy');    // Радость на 2 сек
this.avatarSystem.playReaction('sad');      // Грусть на 2 сек
```

## Интеграция

### В game.js
```javascript
// При добавлении сообщения от Ани
if (type === 'anya') {
    this.avatarSystem.blink();
}

// При выполнении активности
if (result.effects && result.effects.mood > 0) {
    this.avatarSystem.playReaction('happy');
} else if (result.effects && result.effects.mood < 0) {
    this.avatarSystem.playReaction('sad');
}
```

## Оптимизация

### Предзагрузка изображений
Все изображения предзагружаются при инициализации системы и в HTML:
```html
<link rel="preload" href="avatar/обыч.png" as="image">
```

### Плавные переходы
CSS transition обеспечивает плавную смену изображений:
```css
.anya-avatar img {
    transition: opacity 0.15s ease-in-out;
}
```

## Будущие улучшения
- Дополнительные выражения (удивление, злость, смущение)
- Анимация движения глаз
- Реакция на время суток (сонное лицо ночью)
- Специальные анимации для важных событий
